<!DOCTYPE html>

<!--This will create the webpage for the use_model.ts code-->
<html lang = "en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
    <link rel="stylesheet" href="style.css">
    <title>User-Prompted-Melody</title>
    <script> var exports = {}; </script>
    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.23.1"></script>
    <script type = "module">
        import {
            Call_Music,
            Mel_prompt,
            store_Mel,
            retrieve_Mel,
            start_Mel,
            time_Mel,
            stop_Mel,
            Melody,
            MusicVAE
        } from './use_model.js';

        window.Call_Music = Call_Music;
        window.Mel_prompt = Mel_prompt;
        window.store_Mel = store_Mel;
        window.retrieve_Mel = retrieve_Mel;
        window.start_Mel = start_Mel;
        window.time_Mel = time_Mel;
        window.stop_Mel = stop_Mel;
        window.Melody = Melody;
        window.MusicVAE = MusicVAE;

    </script>
</head>

<!--TODO: Create the rest of the code for the function in ts to work on HTML-->
<body>
    <h1>User Prompted Melody</h1>
    <p>Type in the melody prompt:</p>
    <!--This will allow the user to type the prompt-->
    <input type="text" id="Melody" name="Melody-Name">

    <p>Melody Function called:</p>
    <button id = "Melbtn">Calls the Melody</button>
    <br>
    <p>Calls the prompt:</p>
    <button id = "Promptbtn">Call prompt</button>

    <p>Called Melody is being stored:</p>
    <button id = "storeMelbtn">Stores the Melody</button>


    <p> The Melody is now stored.</p>

    <p>Melody is being retrived from storage and is being started</p>

    <button id = "retrieveMelbtn">Retrieve Melody</button>


    <p> This gets the piano keys and then generates based on user click:</p>
    <button class = "simulate-key" data-note="A">A Key</button>
    <button class = "simulate-key" data-note="B">B Key</button>
    <button class = "simulate-key" data-note="C">C Key</button>
    <button class = "simulate-key" data-note="D">D Key</button>
    <button class = "simulate-key" data-note="E">E Key</button>
    <button class = "simulate-key" data-note="F">F Key</button>
    <button class = "simulate-key" data-note="G">G Key</button>
    <button class = "gen_mel">Generate melody</button>

    <p>Retrieved melody is being played</p> 

    <button id = "startMelbtn">Melody has been started</button>

    <p>Melody has been stopped.</p>
    <button id = "stopMelbtn">Melody has been stopped</button>

    <script>
        window.addEventListener('DOMContentLoaded', () => { 
            const melInput = document.getElementById('Melody');
            const callMelBtn = document.getElementById('Melbtn');
            const PromptMelbtn = document.getElementById('Promptbtn');
            const storeMelbtn = document.getElementById('storeMelbtn');
            const retrieveMelbtn = document.getElementById('retrieveMelbtn');
            const startMelbtn = document.getElementById('startMelbtn');
            const stopMelbtn = document.getElementById('stopMelbtn');

            callMelBtn.addEventListener('click', () => {
                if(melInput){
                    Call_Music(melInput.value);
                } 
            });

            PromptMelbtn.addEventListener('click', () => {
                if(melInput){
                    Mel_prompt(melInput.value);
                }
            });

            storeMelbtn.addEventListener('click', () => {
                if(melInput){
                    store_Mel();
                };
            });
            retrieveMelbtn.addEventListener('click', () => {
                if(melInput){
                    retrieve_Mel();
                };
            });
            startMelbtn.addEventListener('click', () => {
                if(melInput){
                    start_Mel();
                };
            });
            stopMelbtn.addEventListener('click', () => {
                if(melInput){
                    stop_Mel();
                };
            });


            const simulate_key = document.querySelectorAll(".simulate-key")

            simulate_key.forEach(key =>  {
                key.addEventListener('click', () => {
                    const note = key.dataset.note;
                    console.log(`play the note ${note}`);
                });
            });
        });

        function playMel(){
            const playMelody = new Melody(MusicVAE)
            playMelody.play();
        }

        function genMel(){
            const gen_key = document.querySelectorAll(".gen_mel")
            gen_key.forEach(new_key => {
                new_key.addEventListener('click', () => {
                    console.log("Generate the melody:");
                    const generate = new Melody(MusicVAE);
                    console.log(generate);
                });
            });
        }
        genMel();
    </script>

</body>
</html>
